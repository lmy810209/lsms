<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>LSMS OUTDOOR Â· ì–‘ì¬ HQ ì‹¤ì™¸ì¡°ê²½ ëŒ€ì‹œë³´ë“œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",
                   "Noto Sans KR","Apple SD Gothic Neo",sans-serif;
      background: #f5f7fb;
      color: #111827;
    }

    /* ===== ì‚¬ì´ë“œë°” (ì ‘í˜ / í¼ì¹¨) ===== */
    .sidebar {
      position: fixed;
      top: 0; left: 0; bottom: 0;
      width: 76px;                  /* ì ‘íŒ ìƒíƒœ í­ */
      background: #020617;          /* ê±°ì˜ ê²€ì •ì— ê°€ê¹Œìš´ ë‚¨ìƒ‰ */
      color: #ffffff;
      padding: 16px 10px 12px;
      display: flex;
      flex-direction: column;
      transition: width 0.22s ease;
      overflow: hidden;             /* ì ‘í˜”ì„ ë•Œ ê¸€ì/ìŠ¤í¬ë¡¤ ìˆ¨ê¹€ */
      border-right: 1px solid #111827;
      z-index: 30;
    }

    /* í¼ì³ì¡Œì„ ë•Œ: í­ + ìŠ¤í¬ë¡¤ */
    .sidebar:hover {
      width: 260px;
      overflow-y: auto;
    }

    /* ===== ë¡œê³  ===== */
    .side-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 18px;
    }

    .side-logo {
      width: 34px;
      height: 34px;
      border-radius: 12px;
      background: #38bdf8;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      flex-shrink: 0;
      color: #0b1120;
    }

    .side-title {
      display: none; /* ì ‘íŒ ìƒíƒœì—ëŠ” ìˆ¨ê¹€ */
    }
    .sidebar:hover .side-title {
      display: block; /* í¼ì³ì¡Œì„ ë•Œë§Œ ë³´ì´ê²Œ */
    }

    .side-title-main {
      font-size: 15px;
      font-weight: 700;
      letter-spacing: .06em;
    }
    .side-title-sub {
      font-size: 11px;
      opacity: .8;
    }

    /* ===== ì„¹ì…˜ ë¼ë²¨ ===== */
    .side-section-label {
      font-size: 10px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: rgba(148,163,184,0.9);
      margin-top: 14px;
      margin-bottom: 6px;
      display: none; /* ì ‘íŒ ìƒíƒœ ìˆ¨ê¹€ */
    }
    .sidebar:hover .side-section-label {
      display: block;
    }

    /* ===== ë©”ë‰´ ===== */
    .nav-list { list-style: none; }

    .nav-item {
      display: flex;
      align-items: center;
      padding: 8px 6px;
      border-radius: 10px;
      cursor: pointer;
      transition: background .16s ease, transform .08s ease;
      margin-bottom: 4px;
    }

    .nav-item:hover {
      background: #111827;
      transform: translateX(2px);
    }

    .nav-item.active {
      background: #1d4ed8;
    }

    .nav-icon-round {
      width: 30px;
      height: 30px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
      flex-shrink: 0;
      font-size: 15px;
    }

    .nav-item.active .nav-icon-round {
      border-color: rgba(255,255,255,0.9);
      background: rgba(15,23,42,0.25);
    }

    .nav-label-wrap {
      display: none; /* ì ‘íŒ ìƒíƒœì—ëŠ” í…ìŠ¤íŠ¸ ìˆ¨ê¹€ */
      flex-direction: column;
    }
    .sidebar:hover .nav-label-wrap {
      display: flex; /* í¼ì³ì¡Œì„ ë•Œë§Œ ë³´ì´ê²Œ */
    }

    .nav-label-main {
      font-size: 13px;
    }
    .nav-label-sub {
      font-size: 11px;
      opacity: .75;
      margin-top: 1px;
    }

    /* ===== ì‚¬ì´ë“œë°” í‘¸í„° ===== */
    .side-footer {
      margin-top: auto;
      font-size: 11px;
      color: #9ca3af;
      border-top: 1px solid #1e293b;
      padding-top: 10px;
      display: none;            /* ì ‘íŒ ìƒíƒœ ìˆ¨ê¹€ */
    }
    .sidebar:hover .side-footer {
      display: block;
    }

    .side-footer-top {
      margin-bottom: 4px;
    }

    /* ===== ë©”ì¸ ì˜ì—­ ===== */
    .main {
      margin-left: 76px;        /* ì ‘íŒ ìƒíƒœ ê¸°ì¤€ */
      min-height: 100vh;
      padding: 18px 24px 24px;
      transition: margin-left 0.22s ease;
    }
    .sidebar:hover ~ .main {
      margin-left: 260px;       /* í¼ì³ì¡Œì„ ë•Œ ì—¬ìœ  í™•ë³´ */
    }

    .main-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }

    .main-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .main-subtitle {
      font-size: 13px;
      color: #6b7280;
    }

    .status-badges {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
      font-size: 12px;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #e7f8eb;
      color: #047857;
      border: 1px solid #bbf7d0;
    }
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #22c55e;
    }
    .status-site { color: #4b5563; }

    /* ===== ì¹´ë“œ ê³µí†µ ===== */
    .card {
      background: #ffffff;
      border-radius: 16px;
      padding: 14px 16px 16px;
      box-shadow: 0 8px 20px rgba(15,23,42,0.06);
      border: 1px solid rgba(148,163,184,0.35);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
    }

    .card-sub {
      font-size: 12px;
      color: #6b7280;
      margin-top: 2px;
    }

    .card-tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
      font-size: 11px;
    }

    .card-tag {
      padding: 2px 7px;
      border-radius: 999px;
      background: #f3f4f6;
      color: #4b5563;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .tag-color {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }
    .tag-blue { background:#2563eb; }
    .tag-red { background:#ef4444; }
    .tag-orange { background:#f97316; }

    /* ===== ë©”ì¸ ë ˆì´ì•„ì›ƒ (ì¢Œ: ì§€ë„/ìš”ì•½, ìš°: ê¸°ìƒ íŒ¨ë„) ===== */
.layout-grid {
  display: grid;
  /* ì™¼ìª½(ì§€ë„+ê·¸ë˜í”„) 78% / ì˜¤ë¥¸ìª½(ë‚ ì”¨) 22% ëŠë‚Œ */
  grid-template-columns: 3.5fr 1fr;
  gap: 18px;
  align-items: flex-start;
}

    .left-main {
      display: flex;
      flex-direction: column;
      gap: 16px;
      min-width: 0;
    }

    .right-panel {
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-width: 0;
    }

    .weather-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 8px;
      margin-bottom: 10px;
    }

    .weather-title {
      font-size: 14px;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .weather-sub {
      font-size: 11px;
      color: #6b7280;
      margin-top: 2px;
    }

    .weather-badge-today {
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 999px;
      background: #ecfdf3;
      border: 1px solid #bbf7d0;
      color: #166534;
      white-space: nowrap; 
      line-height: 1.2;
      margin-top: -1px; 
    }

    .weather-today {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding: 8px 10px;
      border-radius: 10px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
    }

    .weather-today-main {
      font-size: 22px;
      font-weight: 700;
    }

    .weather-today-meta {
      font-size: 11px;
      color: #6b7280;
      margin-top: 2px;
    }

    .weather-today-extra {
      font-size: 11px;
      color: #4b5563;
      text-align: right;
    }

    .weather-forecast-title {
      font-size: 11px;
      font-weight: 600;
      color: #6b7280;
      letter-spacing: .08em;
      text-transform: uppercase;
      margin: 10px 0 6px;
    }

    .weather-forecast-list {
      border-radius: 10px;
      border: 1px solid #d1d5db;
      background: #ffffff;
      padding: 6px 10px;
      font-size: 11px;
    }

    .weather-forecast-row {
      display: grid;
      grid-template-columns: 1.2fr 1.4fr 1.2fr 1.1fr;
      padding: 4px 0;
      border-bottom: 1px dashed #d1d5db;
      align-items: center;
      color: #4b5563;
    }
    .weather-forecast-row:last-child {
      border-bottom: none;
    }
    .weather-forecast-row span:nth-child(2) {
      color: #6b7280;
    }
    .weather-forecast-row span:nth-child(3) {
      text-align: right;
    }
    .weather-forecast-row span:nth-child(4) {
      text-align: right;
    }

    .wf-label-main {
      font-weight: 600;
      font-size: 11px;
      color: #111827;
    }

    .wf-label-sub {
      font-size: 10px;
      color: #6b7280;
    }

    .alert-section-title {
      margin-top: 12px;
      font-size: 12px;
      font-weight: 600;
      color: #111827;
    }

    .alert-hint {
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 6px;
    }

    .alert-list {
      margin-top: 4px;
      font-size: 11px;
      color: #374151;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      padding: 8px 10px;
    }

    .alert-item {
      display: flex;
      align-items: flex-start;
      gap: 6px;
      margin-bottom: 6px;
    }
    .alert-item:last-child {
      margin-bottom: 0;
    }

    .alert-dot-high {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #dc2626;
      margin-top: 4px;
    }
    .alert-dot-warn {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #f97316;
      margin-top: 4px;
    }
    .alert-dot-info {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #2563eb;
      margin-top: 4px;
    }

    .alert-main {
      font-weight: 600;
      margin-bottom: 2px;
    }
    .alert-sub {
      color: #6b7280;
    }

    @media (max-width: 1200px) {
      .layout-grid {
        grid-template-columns: 1fr;
      }
      .right-panel {
        order: -1;
      }
    }

    /* ===== ìƒë‹¨ ê·¸ë¦¬ë“œ (ì§€ë„ + ê·¸ë˜í”„) ===== */
.top-grid {
  display: grid;
  /* ì™¼ìª½ ì§€ë„ ì¹´ë“œê°€ ë” ë„“ê²Œ ë³´ì´ë„ë¡ 2 : 1 ë¹„ìœ¨ë¡œ ì¡°ì • */
  grid-template-columns: 2fr 1fr;
  gap: 16px;
  margin-bottom: 18px;
}

    .map-area {
      border-radius: 12px;
      overflow: hidden;
      background: #e6f2ff;
      height: 520px;
      display: flex;
      align-items: stretch;
      justify-content: center;
      color: #1f2933;
      font-size: 13px;
      position: relative;
    }

    /* ì‹¤ì œ Leaflet ì§€ë„ê°€ ë“¤ì–´ê°ˆ ì˜ì—­ */
    #map {
      width: 100%;
      height: 100%;
    }

    .chart-area {
      border-radius: 12px;
      overflow: hidden;
      background: #f9fafb;
      height: 520px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #4b5563;
      font-size: 13px;
    }

    .chart-placeholder {
      width: 92%;
      height: 86%;
      border-radius: 10px;
      border: 1px dashed #d1d5db;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #6b7280;
      text-align: center;
      padding: 0 12px;
    }

    /* ===== í•˜ë‹¨ ìš”ì•½ ì¹´ë“œ ===== */
    .bottom-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 16px;
      margin-top: 6px;
    }

    .metric-main {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 2px;
    }
    .metric-sub {
      font-size: 12px;
      color: #6b7280;
    }
    .metric-badge-ok,
    .metric-badge-warn,
    .metric-badge-danger {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      display: inline-block;
      margin-top: 4px;
    }
    .metric-badge-ok {
      background: #ecfdf3;
      color: #166534;
      border: 1px solid #bbf7d0;
    }
    .metric-badge-warn {
      background: #fef3c7;
      color: #92400e;
      border: 1px solid #fcd34d;
    }
    .metric-badge-danger {
      background: #fee2e2;
      color: #b91c1c;
      border: 1px solid #fecaca;
    }

    @media (max-width: 1200px) {
      .top-grid { grid-template-columns: 1fr; }
      .map-area, .chart-area { height: 420px; }
    }

    /* ===== Leaflet íŒì—… ìŠ¤íƒ€ì¼ ===== */
    .lsms-tree-popup .leaflet-popup-content {
      margin: 0;
    }
    .lsms-tree-popup .leaflet-popup-content-wrapper {
      border-radius: 12px;
      padding: 0;
      box-shadow: 0 12px 30px rgba(15,23,42,0.25);
    }
    .lsms-tree-popup .leaflet-popup-tip {
      border-top-color: #ffffff;
    }

    .lsms-popup {
      font-size: 12px;
      line-height: 1.5;
      color: #111827;
      min-width: 250px;
      max-width: 280px;
    }
    .lsms-popup-header {
      padding: 8px 10px 6px;
      background: linear-gradient(135deg,#eff6ff,#f9fafb);
      border-bottom: 1px solid #e5e7eb;
    }
    .lsms-popup-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 2px;
    }
    .lsms-popup-sub {
      font-size: 11px;
      color: #6b7280;
    }

    .lsms-popup-body {
      padding: 8px 10px 10px;
    }

    .lsms-tab-nav {
      display: flex;
      gap: 4px;
      margin-bottom: 6px;
      flex-wrap: wrap;
    }
    .lsms-tab-btn {
      flex: 1 1 auto;
      padding: 3px 6px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      color: #6b7280;
      cursor: pointer;
      text-align: center;
      white-space: nowrap;
    }
    .lsms-tab-btn.active {
      background: #e0edff;
      border-color: #2563eb;
      color: #1d4ed8;
      font-weight: 500;
    }

    .lsms-tab-panel {
      display: none;
      font-size: 11.5px;
      color: #374151;
    }
    .lsms-tab-panel.active {
      display: block;
    }

    .lsms-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2px;
      gap: 4px;
    }
    .lsms-row span:first-child {
      color: #6b7280;
    }
    .lsms-row span:last-child {
      color: #111827;
    }
    .lsms-section-title {
      font-size: 11px;
      font-weight: 600;
      color: #4b5563;
      margin-bottom: 4px;
    }
    .lsms-note {
      margin-top: 3px;
      font-size: 11px;
      color: #6b7280;
    }
    .lsms-photo {
      width: 100%;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      margin-bottom: 4px;
      object-fit: cover;
    }
/* ===== Leaflet ì§€ë„ ì˜ì—­ ===== */
.map-layout {
  display: grid;
  grid-template-columns: minmax(0, 2fr) 260px;
  gap: 12px;
}

.map-area {
  border-radius: 12px;
  overflow: hidden;
  background: #e5edf8;
  height: 520px;
  position: relative;
}

#map {
  width: 100%;
  height: 100%;
}

/* ===== ìˆ˜ëª© ë¦¬ìŠ¤íŠ¸ íŒ¨ë„ ===== */
.tree-list-panel {
  border-radius: 12px;
  border: 1px solid rgba(148,163,184,0.5);
  background: #f9fafb;
  padding: 10px 10px 12px;
  display: flex;
  flex-direction: column;
  font-size: 11px;
}

.tree-list-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 6px;
}

.tree-list-title {
  font-size: 12px;
  font-weight: 600;
}

.tree-list-count {
  color: #6b7280;
}

.tree-list-search {
  display: flex;
  gap: 4px;
  margin-bottom: 6px;
}

.tree-list-search input {
  flex: 1;
  padding: 4px 6px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  font-size: 11px;
}

.tree-list-search button {
  border-radius: 8px;
  border: 1px solid #d1d5db;
  background: #ffffff;
  padding: 4px 8px;
  font-size: 11px;
  cursor: pointer;
}

.tree-list-search button:hover {
  background:#e5e7eb;
}

.tree-list-body {
  flex: 1;
  overflow-y: auto;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
  background:#ffffff;
}

.tree-row {
  display: flex;
  align-items: center;
  padding: 5px 6px;
  border-bottom: 1px solid #f3f4f6;
  cursor: pointer;
  gap: 6px;
}

.tree-row:last-child {
  border-bottom: none;
}

.tree-row:hover {
  background:#f3f4ff;
}

.tree-row-badge {
  min-width: 18px;
  height: 18px;
  border-radius: 999px;
  font-size: 11px;
  font-weight: 600;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#0f172a;
}

.tree-row-main {
  flex: 1;
  display:flex;
  flex-direction:column;
}

.tree-row-id {
  font-size:11px;
  font-weight:600;
}

.tree-row-sub {
  font-size:10px;
  color:#6b7280;
}

.tree-row-chip {
  font-size:10px;
  padding:2px 6px;
  border-radius:999px;
  border:1px solid #e5e7eb;
  background:#f9fafb;
  margin-left:4px;
}

.tree-row-delete {
  font-size:14px;
  color:#9ca3af;
  padding:0 4px;
}

.tree-row-delete:hover {
  color:#ef4444;
}

/* ë¦¬ìŠ¤íŠ¸ í•˜ë‹¨ ë²„íŠ¼ */
.tree-list-footer {
  display:flex;
  justify-content:space-between;
  gap:6px;
  margin-top:6px;
}

.tree-list-footer button {
  flex:1;
  border-radius:8px;
  border:1px solid #d1d5db;
  background:#ffffff;
  padding:4px 6px;
  font-size:11px;
  cursor:pointer;
}

.tree-list-footer button:hover {
  background:#e5e7eb;
}

#addModeHint {
  margin-top:4px;
  font-size:10px;
  color:#f97316;
}

/* ===== íŒì—… (ê¸€ë˜ìŠ¤ ì¹´ë“œ ìŠ¤íƒ€ì¼) ===== */
.lsms-tree-popup .leaflet-popup-content {
  margin: 0;
}

.lsms-tree-popup .leaflet-popup-content-wrapper {
  padding:0;
  border-radius: 16px;
  background: rgba(255,255,255,0.96);
  backdrop-filter: blur(14px);
  box-shadow: 0 18px 40px rgba(15,23,42,0.32);
}

.lsms-tree-popup .leaflet-popup-tip {
  display:block;
}

.lsms-popup {
  min-width: 260px;
  max-width: 280px;
  font-size: 11px;
  color:#111827;
}

.lsms-popup-header {
  padding: 10px 14px 8px;
  border-bottom: 1px solid #e5e7eb;
  background: linear-gradient(135deg,#f9fafb,#eef2ff);
}

.lsms-popup-title {
  font-size: 13px;
  font-weight: 700;
  margin-bottom: 2px;
}

.lsms-popup-sub {
  font-size: 10px;
  color:#6b7280;
}

.lsms-popup-body {
  padding: 8px 10px 10px;
}

/* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
.lsms-tab-nav {
  display:flex;
  flex-wrap:wrap;
  gap:4px;
  margin-bottom:6px;
}

.lsms-tab-btn {
  border:none;
  padding:3px 8px;
  border-radius:999px;
  font-size:10px;
  background:#f3f4f6;
  color:#4b5563;
  cursor:pointer;
}

.lsms-tab-btn.active {
  background:#2563eb;
  color:#ffffff;
}

/* íƒ­ íŒ¨ë„ */
.lsms-tab-panel {
  display:none;
}

.lsms-tab-panel.active {
  display:block;
}

.lsms-section-title {
  font-size:11px;
  font-weight:600;
  margin:4px 0 4px;
}

.lsms-row {
  display:flex;
  justify-content:space-between;
  margin-bottom:2px;
}

.lsms-row span:first-child {
  color:#6b7280;
}

.lsms-note {
  margin-top:4px;
  font-size:10px;
  color:#6b7280;
}

.lsms-photo {
  width:100%;
  border-radius:8px;
  margin-bottom:4px;
}
  </style>
</head>
<body>

<!-- ========== ì‚¬ì´ë“œë°” ========== -->
<aside class="sidebar">
  <div class="side-header">
    <div class="side-logo">LS</div>
    <div class="side-title">
      <div class="side-title-main">LSMS OUTDOOR</div>
      <div class="side-title-sub">Hyundai Â· Yangjae HQ</div>
    </div>
  </div>

  <div class="side-section-label">MAIN</div>
  <ul class="nav-list">
    <li class="nav-item active">
      <div class="nav-icon-round">ğŸ™</div>
      <div class="nav-label-wrap">
        <span class="nav-label-main">ì–‘ì¬HQ ì‹¤ì™¸ì¡°ê²½ í˜„í™©</span>
        <span class="nav-label-sub">ì§€ë„ë¡œ í•œ ë²ˆì— ë³´ëŠ” ìœ„í—˜Â·ìƒíƒœ ìš”ì•½</span>
      </div>
    </li>
    <li class="nav-item">
      <div class="nav-icon-round">âš </div>
      <div class="nav-label-wrap">
        <span class="nav-label-main">ì „ë„ ìœ„í—˜ ìˆ˜ëª© ëª¨ë‹ˆí„°ë§</span>
        <span class="nav-label-sub">Structural Risk Score Â· íƒœí’Â·ê°•í’ ëŒ€ë¹„</span>
      </div>
    </li>
    <li class="nav-item">
      <div class="nav-icon-round">ğŸ¦ </div>
      <div class="nav-label-wrap">
        <span class="nav-label-main">ë³‘í•´ì¶©Â·ìˆ˜ì„¸ ì´ìƒ ê°ì‹œ</span>
        <span class="nav-label-sub">ê¸°ìƒÂ·ìƒìœ¡ ì¡°ê±´ì„ ë°˜ì˜í•œ ì˜ˆì¸¡</span>
      </div>
    </li>
  </ul>

  <div class="side-section-label">DATA</div>
  <ul class="nav-list">
    <li class="nav-item">
      <div class="nav-icon-round">ğŸ’§</div>
      <div class="nav-label-wrap">
        <span class="nav-label-main">ê´€ìˆ˜ëŸ‰Â·í† ì–‘ìˆ˜ë¶„ ê¸°ë¡</span>
        <span class="nav-label-sub">í† ì–‘ ê±´ì¡°Â·ê³¼ìŠµ ê²½í–¥ í™•ì¸</span>
      </div>
    </li>
    <li class="nav-item">
      <div class="nav-icon-round">ğŸŒ¡</div>
      <div class="nav-label-wrap">
        <span class="nav-label-main">ê¸°ìƒÂ·í™˜ê²½ ì„¼ì„œ ë°ì´í„°</span>
        <span class="nav-label-sub">ì˜¨ë„Â·ê°•ìˆ˜Â·ë°”ëŒÂ·í† ì–‘ ì •ë³´ ì—°ë™</span>
      </div>
    </li>
  </ul>

  <div class="side-footer">
    <div class="side-footer-top">LMY Â· Site Manager</div>
    <div>v0.1 OUTDOOR SAMPLE Â· ì–‘ì¬ HQ</div>
  </div>
</aside>

<!-- ========== ë©”ì¸ ì˜ì—­ ========== -->
<main class="main">

  <!-- ìƒë‹¨ ì œëª© -->
  <header class="main-header">
    <div>
      <div class="main-title">ì–‘ì¬ HQ ì‹¤ì™¸ì¡°ê²½ í˜„í™© Â· LSMS OUTDOOR</div>
      <div class="main-subtitle">
        ê¸°ìƒÂ·ì§€í˜•Â·ìˆ˜ëª© ìƒíƒœë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì „ë„ ìœ„í—˜Â·ë³‘í•´ì¶© ìœ„í—˜ì„ ì˜ˆì¸¡í•˜ëŠ” ì‹¤ì™¸ ìˆ˜ëª© ê´€ë¦¬ ì „ìš© ëŒ€ì‹œë³´ë“œì…ë‹ˆë‹¤.
      </div>
    </div>
    <div class="status-badges">
      <div class="status-pill">
        <span class="status-dot"></span>
        ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì˜¨ë¼ì¸
      </div>
      <div class="status-site">í˜„ì¥: í˜„ëŒ€ì°¨ ì–‘ì¬ ë³¸ì‚¬</div>
    </div>
  </header>

  <!-- ì™¼ìª½: ì§€ë„/ìš”ì•½  Â·  ì˜¤ë¥¸ìª½: ê¸°ìƒÂ·ê²½ë³´ íŒ¨ë„ -->
  <div class="layout-grid">
    <!-- ì™¼ìª½ ë©”ì¸ ì˜ì—­ -->
    <div class="left-main">

      <!-- ìƒë‹¨: ì§€ë„ + ê·¸ë˜í”„ -->
      <section class="top-grid">

        <!-- ì§€ë„ ì¹´ë“œ -->
        <article class="card">
          <div class="card-header">
            <div>
              <div class="card-title">ì–‘ì¬ HQ ì‹¤ì™¸ì¡°ê²½ ì§€ë„ Â· ì „ë„ ìœ„í—˜Â·ë³‘í•´ì¶© í¬ì¸íŠ¸</div>
              <div class="card-sub">
                í† ì–‘ ê²½ì‚¬Â·ìˆ˜ê°„ ê¸°ìš¸ê¸°Â·ë³´í–‰ ë™ì„ Â·ê³¼ê±° ì´ë ¥ ê¸°ë°˜ ì „ë„ ìœ„í—˜Â·ë³‘í•´ì¶© ë°œìƒ í¬ì¸íŠ¸ë¥¼ ì§€ë„ì—ì„œ ì§ê´€ì ìœ¼ë¡œ í™•ì¸í•©ë‹ˆë‹¤.
              </div>
              <div class="card-tag-row">
                <span class="card-tag"><span class="tag-color tag-blue"></span>ì „ë„ ìœ„í—˜ ì˜ˆì¸¡ í¬ì¸íŠ¸</span>
                <span class="card-tag"><span class="tag-color tag-red"></span>ë³‘í•´ì¶©Â·ê³ ì‚¬ ì˜ì‹¬ ìˆ˜ëª©</span>
                <span class="card-tag"><span class="tag-color tag-orange"></span>ì§‘ì¤‘ ê´€ë¦¬ í•„ìš” êµ¬ê°„</span>
              </div>
            </div>
            <div style="font-size:11px; color:#6b7280;">Map Â· Leaflet / Mapbox</div>
          </div>

          <div class="map-area">
            <div id="map" style="width:100%;height:100%;"></div>
          </div>
        </article>

        <!-- ê·¸ë˜í”„ ì¹´ë“œ (ìƒ˜í”Œ ìë¦¬) -->
        <article class="card">
          <div class="card-header">
            <div>
              <div class="card-title">ì‹¤ì™¸ ìˆ˜ëª© ìœ„í—˜Â·ìƒíƒœ ìš”ì•½</div>
              <div class="card-sub">
                êµ¬ì—­ë³„ ì „ë„ ìœ„í—˜ ì§€ìˆ˜Â·ë³‘í•´ì¶©Â·ê±´ì¡° ê²½í–¥ì„ ê·¸ë˜í”„ë¡œ í•œ ë²ˆì— í™•ì¸ (ê´€ìˆ˜ ì§€ì‹œëŠ” í•˜ì§€ ì•Šê³ , ì ê²€Â·ìš°ì„ ìˆœìœ„ë§Œ í‘œì‹œ)
              </div>
            </div>
            <div style="font-size:11px; color:#6b7280;">ë‹¨ìœ„: ìœ„í—˜ ì§€ìˆ˜ (0~100, ë†’ì„ìˆ˜ë¡ ìœ„í—˜)</div>
          </div>

          <div class="card-tag-row" style="margin-bottom:8px;">
            <span class="card-tag"><span class="tag-color tag-blue"></span>ì‚¬ë©´ë¶€(Aì¡´)</span>
            <span class="card-tag"><span class="tag-color tag-red"></span>ë„ë¡œë³€(Bì¡´)</span>
            <span class="card-tag"><span class="tag-color tag-orange"></span>ê´‘ì¥Â·ë³´í–‰ë™ì„ (Cì¡´)</span>
          </div>

          <div class="chart-area">
            <div class="chart-placeholder">
              ì¶”í›„ Chart.js ë“± ê·¸ë˜í”„ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—°ë™ ì˜ˆì • ì˜ì—­ì…ë‹ˆë‹¤.  
              í˜„ì¬ëŠ” êµ¬ì—­ë³„ ìœ„í—˜ ì§€ìˆ˜ ë³€í™”ë¥¼ í‘œì‹œí•˜ëŠ” ìë¦¬ë§Œ êµ¬ì„±í•´ ë‘” ìƒíƒœì…ë‹ˆë‹¤.
            </div>
          </div>
        </article>

      </section>

      <!-- í•˜ë‹¨ ìš”ì•½ ì¹´ë“œ 3ê°œ -->
      <section class="bottom-grid">

        <article class="card">
          <div class="card-title">ì „ë„ ìœ„í—˜ High ìˆ˜ëª©</div>
          <div class="metric-main">3ì£¼</div>
          <div class="metric-sub">
            ê°•í’ ì˜ˆë³´ êµ¬ê°„ê³¼ ì¤‘ì²©ë˜ëŠ” ê°œì²´ Â· ì¦‰ì‹œ í˜„ì¥ ì ê²€ ë° ì „ì •Â·ì§€ì§€ëŒ€ ë³´ê°• í•„ìš”
          </div>
          <span class="metric-badge-danger">ì •ë¬¸Â·ë³´í–‰ í†µí–‰ëŸ‰ ë†’ì€ êµ¬ê°„ ìš°ì„ </span>
        </article>

        <article class="card">
          <div class="card-title">ë³‘í•´ì¶© ì˜ì‹¬ í¬ì¸íŠ¸</div>
          <div class="metric-main">7ì§€ì </div>
          <div class="metric-sub">
            ì €ì¡°ë„Â·í†µí’ ë¶ˆëŸ‰Â·ê±´ì¡° ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ì¤‘ì²©ë˜ëŠ” êµ¬ì—­ Â· ì—´ìƒ/ë³€ìƒ‰ ë°œìƒ ê°œì²´ ìš°ì„  ì ê²€
          </div>
          <span class="metric-badge-warn">ì˜ˆë°© ë°©ì œ ì¤‘ì‹¬ ê´€ë¦¬ ê¶Œì¥</span>
        </article>

        <article class="card">
          <div class="card-title">ê¸°ìƒÂ·í™˜ê²½ ìš°ì„  ì ê²€ êµ¬ê°„</div>
          <div class="metric-main">ì‚¬ë©´ë¶€ 2êµ¬ì—­</div>
          <div class="metric-sub">
            ì—°ì† ê°•ìš°Â·ë°°ìˆ˜ ë¶ˆëŸ‰ ìš°ë ¤ êµ¬ê°„ Â· ì‚¬ë©´ ë¶•ê´´Â·ì „ë„ ìœ„í—˜ ìˆ˜ëª© ì£¼ê°„ 1íšŒ ì´ìƒ ëˆˆê²€ì‚¬ ê¶Œì¥
          </div>
          <span class="metric-badge-ok">ê´€ìˆ˜ ì§€ì‹œ ì—†ì´ â€œì ê²€ ìš°ì„ ìˆœìœ„â€ë§Œ ì•ˆë‚´</span>
        </article>

      </section>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ê¸°ìƒÂ·ê°•í’ + ìë™ ê²½ë³´ íŒ¨ë„ -->
    <aside class="right-panel">
      <article class="card">
        <div class="weather-card-header">
          <div>
            <div class="weather-title">ì˜¤ëŠ˜Â·7ì¼ ê¸°ìƒ Â· ê°•í’ ì˜ˆë³´</div>
            <div class="weather-sub">
              ì–‘ì¬ HQ ê¸°ì¤€ ê¸°ì˜¨Â·ê°•ìˆ˜Â·í’ì† ìš”ì•½ Â· ë³‘í•´ì¶©Â·ì „ë„ ìœ„í—˜ ì¡°ê¸° ì˜ˆì¸¡ìš© ê¸°ì´ˆ ë°ì´í„°
            </div>
          </div>
          <span class="weather-badge-today">ì‹¤ì‹œê°„ ì˜ˆë³´ ì—°ë™ ì˜ˆì •</span>
        </div>

        <!-- ì˜¤ëŠ˜ ì •ë³´ -->
        <div class="weather-today">
          <div>
            <div class="weather-today-main" id="todayTemp">27Â°C</div>
            <div class="weather-today-meta" id="todayMeta">ì²´ê° 29Â°C Â· ìŠµë„ 68%</div>
          </div>
          <div class="weather-today-extra" id="todayExtra">
            ê°•ìˆ˜í™•ë¥  30%<br>
            í‰ê·  í’ì† 4 m/s<br>
            ìˆœê°„ ìµœëŒ€ 9 m/s
          </div>
        </div>

        <!-- 7ì¼ ì˜ˆë³´ ìš”ì•½ (ìƒ˜í”Œ ê°’) -->
        <div class="weather-forecast-title">7ì¼ ì˜ˆë³´</div>
        <div class="weather-forecast-list" id="forecastList">
          
       <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ìë™ìœ¼ë¡œ í–‰(row)ë“¤ì„ ì±„ì›Œ ë„£ìŒ -->
      </div>

        <!-- ê¸°ìƒ ê¸°ë°˜ ìë™ ê²½ë³´ -->
        <div class="alert-section-title">ê¸°ìƒ ê¸°ë°˜ ìë™ ê²½ë³´ (ë£° ì—”ì§„ ìƒ˜í”Œ)</div>
        <div class="alert-hint">
          ê¸°ì˜¨Â·ìŠµë„Â·ê°•ìˆ˜Â·í’ì†ì„ ì¡°í•©í•´ì„œ â€œì˜¤ëŠ˜ ì–´ë–¤ ì‘ì—…ì„ ìš°ì„ í•´ì•¼ í•˜ëŠ”ì§€â€ ì œì•ˆí•©ë‹ˆë‹¤.
          (ì¶”í›„ API ì—°ë™ ì‹œ ìë™ ê³„ì‚°)
        </div>

        <div class="alert-list">
          <div class="alert-item">
            <div class="alert-dot-warn"></div>
            <div>
              <div class="alert-main">ê±´ì¡° + ê³ ì˜¨ êµ¬ê°„</div>
              <div class="alert-sub">
                ë‚® ìµœê³  29Â°C, ìƒëŒ€ìŠµë„ 40% ì´í•˜ ì˜ˆë³´ â†’ ì§„ë”§ë¬¼Â·ì‘ì•  ë“± í¡ì¦™ì„± í•´ì¶© ì¦ê°€ ê°€ëŠ¥ì„± â†‘
                <br>â‡’ ì‹ ì´ˆÂ·ìˆ˜ì„¸ ì•½í•œ êµëª© ìœ„ì£¼ë¡œ ì ë’·ë©´ ì ê²€, ì˜ˆë°© ìœ„ì£¼ ë°©ì œ ê³„íš ê²€í† 
              </div>
            </div>
          </div>

          <div class="alert-item">
            <div class="alert-dot-info"></div>
            <div>
              <div class="alert-main">ì¥ë§ˆ + ì €ì˜¨ë‹¤ìŠµ</div>
              <div class="alert-sub">
                5ì¼ í›„ ì—°ì† ê°•ìš°Â·ìŠµë„ 90% ê·¼ì ‘ ì˜ˆë³´ â†’ ê· ë¥˜ì„± ìë§ˆë¦„Â·ê°€ì§€ë§ˆë¦„ë³‘ ë°œìƒ ê°€ëŠ¥ì„±
                <br>â‡’ í†µí’ ë¶ˆëŸ‰ êµ¬ì—­(ê±´ë¬¼ ë²½ë©´, í™ í‘œë©´ í”¼ë³µ ë§ì€ ê³³) ìš°ì„  ì ê²€
              </div>
            </div>
          </div>

          <div class="alert-item">
            <div class="alert-dot-high"></div>
            <div>
              <div class="alert-main">ê°•í’ ì˜ˆë³´ Â· ì „ë„ ìœ„í—˜</div>
              <div class="alert-sub">
                4ì¼ í›„ ìµœëŒ€ í’ì† 9 m/s ì´ìƒ ì˜ˆë³´ â†’ ì „ë„ ìœ„í—˜ ìˆ˜ëª© ì¦‰ì‹œ ëª©ë¡í™”
                <br>â‡’ ì‚¬ë©´ë¶€Â·ë„ë¡œë³€ ì§€ì£¼ ì•½í•œ ìˆ˜ëª© ì¤‘ì‹¬ìœ¼ë¡œ ì™€ì´ì–´ ê¸´ì¥ë„Â·ë¿Œë¦¬ ë“¤ë¦¼ í˜„ì¥ ì ê²€
              </div>
            </div>
          </div>

          <div class="alert-item">
            <div class="alert-dot-info"></div>
            <div>
              <div class="alert-main">í­ìš° Â· ë°°ìˆ˜ ì·¨ì•½ êµ¬ê°„</div>
              <div class="alert-sub">
                5ì¼ í›„ ì¼ ê°•ìˆ˜ëŸ‰ 80mm ìˆ˜ì¤€ ì˜ˆë³´ â†’ ì‚¬ë©´ë¶€/ì§‘ìˆ˜ì • ì£¼ë³€ ë°°ìˆ˜ ìƒíƒœ ì²´í¬
                <br>â‡’ í† ì–‘ í¬í™”ê°€ ì˜ˆìƒë˜ëŠ” êµ¬ì—­ì˜ ê³ ì‚¬ ìœ„í—˜ ìˆ˜ëª©ì„ â€œìš°ì„  ìˆœì°° ë¦¬ìŠ¤íŠ¸â€ì— ìë™ ë“±ë¡
              </div>
            </div>
          </div>
        </div>
      </article>
    </aside>
  </div>
</main>


<!-- ========== ì§€ë„ ìŠ¤í¬ë¦½íŠ¸ ========== -->
<script>
  // 1) Mapbox + Leaflet ì§€ë„ ì—°ê²°
  const mapboxToken =
    "pk.eyJ1IjoibG15ODEyOSIsImEiOiJjbWh3dnlyOTgwMHE1Mmpvb2JuMTlhOGJmIn0.JaECwKXnoTknVOnlrMerFA";

  const map = L.map("map", {
    zoomControl: true,
    attributionControl: false
  }).setView([37.4643, 127.0428], 18);

  L.tileLayer(
    "https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=" + mapboxToken,
    {
      id: "mapbox/light-v11",
      tileSize: 512,
      zoomOffset: -1,
      maxZoom: 22
    }
  ).addTo(map);

  // ===== 2) ê¸°ë³¸ ìˆ˜ëª© ë°ì´í„° (ì´ˆê¸°ê°’) =====
  let treeData = [
    {
      id: "YA-001",
      species: "ì†Œë‚˜ë¬´",
      type: "êµëª©",
      status: "ì–‘í˜¸",
      zone: "ì •ë¬¸ Aì¡´",
      lat: 37.46450,
      lng: 127.04285,
      height: 7.2,
      dbh: 28,
      crown: 5.4,
      planted_year: 2012,
      slope: 8,
      tilt: 4,
      root_lift: false,
      drainage: "ë³´í†µ",
      trunk_crack: false,
      crown_lean: "ì•½í•¨",
      risk_score: 37,
      health_score: 82,
      risk_level: "LOW",
      history: {
        pruning: "2024-03-20",
        pest: "2024-07-11",
        fertilize: "2024-05-15",
        inspection: "2024-08-03",
        memo: "ì‚¬ë©´ë¶€ ë°°ìˆ˜ ì ê²€ í•„ìš”"
      },
      disease: {
        has_issue: false,
        last_date: "-",
        detail: "-"
      },
      tag_id: "RFID-A001",
      nfc_id: "NFC-A001",
      qr_id: "QR-A001",
      sensor_id: "sensor_12",
      photo_url: "",
      created_by: "LMY",
      created_at: "2024-01-05",
      updated_at: "2024-09-12"
    },
    {
      id: "YA-002",
      species: "ì‚°ë²šë‚˜ë¬´",
      type: "êµëª©",
      status: "ì£¼ì˜",
      zone: "ë„ë¡œë³€ Bì¡´",
      lat: 37.46463,
      lng: 127.04265,
      height: 6.1,
      dbh: 24,
      crown: 4.1,
      planted_year: 2014,
      slope: 14,
      tilt: 7,
      root_lift: true,
      drainage: "ë¶ˆëŸ‰",
      trunk_crack: false,
      crown_lean: "ì¤‘ê°„",
      risk_score: 62,
      health_score: 74,
      risk_level: "MOD",
      history: {
        pruning: "2024-04-15",
        pest: "2024-08-10",
        fertilize: "2024-05-02",
        inspection: "2024-09-01",
        memo: "ë°°ìˆ˜ ë¶ˆëŸ‰ + ë¿Œë¦¬ ë“¤ë¦¼ ê´€ì°°ë¨"
      },
      disease: {
        has_issue: true,
        last_date: "2024-08-10",
        detail: "ì ë°˜ì  + ì¤„ê¸° ê»ì§ˆ ê°ˆë¼ì§ ê´€ì°°, ì˜ˆë°© ë°©ì œ ì™„ë£Œ"
      },
      tag_id: "RFID-B021",
      nfc_id: "NFC-B021",
      qr_id: "QR-B021",
      sensor_id: "sensor_19",
      photo_url: "",
      created_by: "LMY",
      created_at: "2024-01-05",
      updated_at: "2024-10-12"
    },
    {
      id: "YA-003",
      species: "íšŒì–‘ëª©",
      type: "ê´€ëª©",
      status: "ì–‘í˜¸",
      zone: "ê´‘ì¥ Cì¡´",
      lat: 37.46440,
      lng: 127.04295,
      height: 1.1,
      dbh: 6,
      crown: 1.2,
      planted_year: 2020,
      slope: 2,
      tilt: 1,
      root_lift: false,
      drainage: "ì–‘í˜¸",
      trunk_crack: false,
      crown_lean: "ì—†ìŒ",
      risk_score: 20,
      health_score: 90,
      risk_level: "LOW",
      history: {
        pruning: "2024-04-02",
        pest: "-",
        fertilize: "2024-06-14",
        inspection: "2024-08-21",
        memo: ""
      },
      disease: {
        has_issue: false,
        last_date: "-",
        detail: "-"
      },
      tag_id: "RFID-C102",
      nfc_id: "",
      qr_id: "QR-C102",
      sensor_id: "",
      photo_url: "",
      created_by: "LMY",
      created_at: "2024-01-10",
      updated_at: "2024-07-07"
    }
  ];

  // ë§ˆì»¤ ì €ì¥ìš©
  let markersById = {};
  const markerLayer = L.layerGroup().addTo(map);

  // ===== 3) ìˆ˜ì¢… + ìœ„í—˜ë„ ê¸°ë°˜ ìƒ‰ìƒ =====
  function getSpeciesColor(species) {
    if (species.includes("ì†Œë‚˜ë¬´")) return "#22c55e";          // ì´ˆë¡
    if (species.includes("ë²šë‚˜ë¬´")) return "#38bdf8";          // í•˜ëŠ˜
    if (species.includes("íšŒì–‘ëª©")) return "#eab308";          // ë…¸ë‘
    return "#6b7280";
  }

  function getRiskRingColor(tree) {
    if (tree.risk_level === "HIGH") return "#ef4444";
    if (tree.risk_level === "MOD") return "#eab308";
    return "#22c55e";
  }

  // ===== 4) ìˆ˜ëª© ì „ì²´ ë‹¤ì‹œ ê·¸ë¦¬ê¸° (ë§ˆì»¤ + íŒì—…) =====
  function renderTreesOnMap() {
    markerLayer.clearLayers();
    markersById = {};

    treeData.forEach((tree, index) => {
      const color = getSpeciesColor(tree.species || "");
      const ringColor = getRiskRingColor(tree);
      const number = index + 1;
      const hasDisease = tree.disease && tree.disease.has_issue;

      const iconHtml = `
        <div style="
          width:24px;height:24px;
          border-radius:999px;
          background:${color};
          border:2px solid ${ringColor};
          box-shadow:${hasDisease
            ? "0 0 10px rgba(248,113,113,0.9)"
            : "0 0 5px rgba(15,23,42,0.4)"};
          display:flex;align-items:center;justify-content:center;
          font-size:12px;font-weight:600;
          color:#0f172a;
        ">
          ${number}
        </div>
      `;

      const icon = L.divIcon({
        className: "",
        html: iconHtml,
        iconSize: [24,24],
        iconAnchor: [12,24],
        popupAnchor: [0,-22]
      });

      const marker = L.marker([tree.lat, tree.lng], { icon }).addTo(markerLayer);
      markersById[tree.id] = marker;

      const diseaseText = tree.disease?.has_issue ? "ìˆìŒ" : "ì—†ìŒ";

      const popupHTML = `
        <div class="lsms-popup">
          <div class="lsms-popup-header">
            <div class="lsms-popup-title">${tree.id} Â· ${tree.species}</div>
            <div class="lsms-popup-sub">
              ${tree.zone || "-"} Â· ${tree.type || "-"} Â· ìƒíƒœ ${tree.status || "-"}
            </div>
          </div>
          <div class="lsms-popup-body">
            <div class="lsms-tab-nav">
              <button class="lsms-tab-btn active" data-tab="basic">ìƒìœ¡ ì •ë³´</button>
              <button class="lsms-tab-btn" data-tab="risk">ì „ë„ ìœ„í—˜</button>
              <button class="lsms-tab-btn" data-tab="manage">ìµœê·¼ ê´€ë¦¬</button>
              <button class="lsms-tab-btn" data-tab="disease">ë³‘í•´ì¶© ì´ë ¥</button>
              <button class="lsms-tab-btn" data-tab="tag">íƒœê·¸Â·ì„¼ì„œ</button>
              <button class="lsms-tab-btn" data-tab="photo">ì‚¬ì§„Â·ë©”ëª¨</button>
            </div>

            <!-- ìƒìœ¡ ì •ë³´ -->
            <div class="lsms-tab-panel active" data-tab-panel="basic">
              <div class="lsms-section-title">ìƒìœ¡ ì •ë³´</div>
              <div class="lsms-row"><span>ìˆ˜ê³ (H)</span><span>${tree.height ?? "-"} m</span></div>
              <div class="lsms-row"><span>í‰ê³  ì§ê²½</span><span>${tree.dbh ?? "-"} cm</span></div>
              <div class="lsms-row"><span>ìˆ˜ê´€í­</span><span>${tree.crown ?? "-"} m</span></div>
              <div class="lsms-row"><span>ì‹ì¬ì—°ë„</span><span>${tree.planted_year ?? "-"}</span></div>
              <div class="lsms-row"><span>ê±´ê°•ë„ ì ìˆ˜</span><span>${tree.health_score ?? "-"}</span></div>
            </div>

            <!-- ì „ë„ ìœ„í—˜ -->
            <div class="lsms-tab-panel" data-tab-panel="risk">
              <div class="lsms-section-title">ì „ë„ ìœ„í—˜</div>
              <div class="lsms-row"><span>ìœ„í—˜ ë“±ê¸‰</span><span>${tree.risk_level || "-"} (ì ìˆ˜ ${tree.risk_score ?? "-"})</span></div>
              <div class="lsms-row"><span>ê²½ì‚¬ë„</span><span>${tree.slope ?? "-"} %</span></div>
              <div class="lsms-row"><span>ìˆ˜ê°„ ê¸°ìš¸ê¸°</span><span>${tree.tilt ?? "-"} Â°</span></div>
              <div class="lsms-row"><span>ë¿Œë¦¬ ë“¤ë¦¼</span><span>${tree.root_lift ? "ìˆìŒ" : "ì—†ìŒ"}</span></div>
              <div class="lsms-row"><span>ë°°ìˆ˜ ìƒíƒœ</span><span>${tree.drainage || "-"}</span></div>
              <div class="lsms-row"><span>ìˆ˜ê°„ ê· ì—´</span><span>${tree.trunk_crack ? "ìˆìŒ" : "ì—†ìŒ"}</span></div>
              <div class="lsms-row"><span>ìˆ˜ê´€ í¸ì¤‘</span><span>${tree.crown_lean || "-"}</span></div>
            </div>

            <!-- ìµœê·¼ ê´€ë¦¬ -->
            <div class="lsms-tab-panel" data-tab-panel="manage">
              <div class="lsms-section-title">ìµœê·¼ ê´€ë¦¬ ì´ë ¥</div>
              <div class="lsms-row"><span>ì „ì •</span><span>${tree.history?.pruning || "-"}</span></div>
              <div class="lsms-row"><span>ë°©ì œ</span><span>${tree.history?.pest || "-"}</span></div>
              <div class="lsms-row"><span>ì‹œë¹„</span><span>${tree.history?.fertilize || "-"}</span></div>
              <div class="lsms-row"><span>ì ê²€</span><span>${tree.history?.inspection || "-"}</span></div>
              <div class="lsms-note">ë©”ëª¨: ${tree.history?.memo || "-"}</div>
            </div>

            <!-- ë³‘í•´ì¶© ì´ë ¥ -->
            <div class="lsms-tab-panel" data-tab-panel="disease">
              <div class="lsms-section-title">ë³‘í•´ì¶© ë°œìƒ ì´ë ¥</div>
              <div class="lsms-row"><span>í”¼í•´ ë°œìƒ ì—¬ë¶€</span><span>${diseaseText}</span></div>
              <div class="lsms-row"><span>ìµœê·¼ ë°œìƒì¼</span><span>${tree.disease?.last_date || "-"}</span></div>
              <div class="lsms-note">${tree.disease?.detail || "-"}</div>
            </div>

            <!-- íƒœê·¸Â·ì„¼ì„œ -->
            <div class="lsms-tab-panel" data-tab-panel="tag">
              <div class="lsms-section-title">QR / NFC / RFID Â· ì„¼ì„œ</div>
              <div class="lsms-row"><span>RFID tag</span><span>${tree.tag_id || "-"}</span></div>
              <div class="lsms-row"><span>NFC ID</span><span>${tree.nfc_id || "-"}</span></div>
              <div class="lsms-row"><span>QR ì½”ë“œ ID</span><span>${tree.qr_id || "-"}</span></div>
              <div class="lsms-row"><span>ì„¼ì„œ ID</span><span>${tree.sensor_id || "-"}</span></div>
            </div>

            <!-- ì‚¬ì§„Â·ë©”ëª¨ -->
            <div class="lsms-tab-panel" data-tab-panel="photo">
              <div class="lsms-section-title">í˜„ì¥ ì‚¬ì§„ Â· ë©”ëª¨</div>
              ${
                tree.photo_url
                  ? `<img src="${tree.photo_url}" alt="í˜„ì¥ ì‚¬ì§„" class="lsms-photo">`
                  : `<div class="lsms-note">ì•„ì§ ë“±ë¡ëœ ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤.</div>`
              }
              <div class="lsms-note">ì‘ì„±: ${tree.created_by || "-"} / ìµœì´ˆë“±ë¡ ${tree.created_at || "-"} / ìµœì¢…ìˆ˜ì • ${tree.updated_at || "-"}</div>
            </div>
          </div>
        </div>
      `;

      marker.bindPopup(popupHTML, {
        maxWidth: 280,
        className: "lsms-tree-popup",
        autoPan: true,
        autoPanPadding: [40,80]
      });

      marker.on("click", () => {
        map.setView([tree.lat, tree.lng], 18, { animate: true });
        marker.openPopup();
      });
    });

    updateTreeList();
  }

  // ===== 5) íŒì—… íƒ­ ë²„íŠ¼ ì „ì—­ ì²˜ë¦¬ =====
  document.addEventListener("click", (event) => {
    const btn = event.target.closest(".lsms-tab-btn");
    if (!btn) return;

    const popup = btn.closest(".lsms-popup");
    if (!popup) return;

    const tab = btn.getAttribute("data-tab");
    const allBtns = popup.querySelectorAll(".lsms-tab-btn");
    const panels = popup.querySelectorAll(".lsms-tab-panel");

    allBtns.forEach((b) => b.classList.toggle("active", b === btn));
    panels.forEach((p) => {
      const panelTab = p.getAttribute("data-tab-panel");
      p.classList.toggle("active", panelTab === tab);
    });
  });

  // ===== 6) ìˆ˜ëª© ë¦¬ìŠ¤íŠ¸ íŒ¨ë„ ë Œë”ë§ =====
  const treeListBody = document.getElementById("treeListBody");
  const treeCountEl = document.getElementById("treeCount");
  const searchInput = document.getElementById("treeSearchInput");
  const addHint = document.getElementById("addModeHint");

  function updateTreeList(filterText = "") {
    if (!treeListBody) return;

    const keyword = filterText.trim().toLowerCase();
    const filtered = treeData.filter((t) => {
      if (!keyword) return true;
      return (
        (t.id || "").toLowerCase().includes(keyword) ||
        (t.species || "").toLowerCase().includes(keyword) ||
        (t.zone || "").toLowerCase().includes(keyword)
      );
    });

    treeCountEl.textContent = treeData.length.toString();

    treeListBody.innerHTML = "";
    filtered.forEach((tree, idx) => {
      const row = document.createElement("div");
      row.className = "tree-row";
      row.dataset.treeId = tree.id;

      const badge = document.createElement("div");
      badge.className = "tree-row-badge";
      badge.style.background = getSpeciesColor(tree.species || "");
      badge.textContent = String(idx + 1);

      const main = document.createElement("div");
      main.className = "tree-row-main";
      main.innerHTML = `
        <div class="tree-row-id">${tree.id} Â· ${tree.species}</div>
        <div class="tree-row-sub">${tree.zone || "-"} Â· ${tree.type || "-"}</div>
      `;

      const chips = document.createElement("div");
      const chip = document.createElement("span");
      chip.className = "tree-row-chip";
      chip.textContent = `ìœ„í—˜ ${tree.risk_level || "-"}`;
      chips.appendChild(chip);

      const del = document.createElement("div");
      del.className = "tree-row-delete";
      del.textContent = "Ã—";

      del.addEventListener("click", (e) => {
        e.stopPropagation();
        if (!confirm(`${tree.id} ì‚­ì œí• ê¹Œìš”?`)) return;
        treeData = treeData.filter((t) => t.id !== tree.id);
        renderTreesOnMap();
      });

      row.appendChild(badge);
      row.appendChild(main);
      row.appendChild(chips);
      row.appendChild(del);

      row.addEventListener("click", () => {
        focusTree(tree.id);
      });

      treeListBody.appendChild(row);
    });
  }

  function focusTree(treeId) {
    const tree = treeData.find((t) => t.id === treeId);
    const marker = markersById[treeId];
    if (!tree || !marker) return;
    map.setView([tree.lat, tree.lng], 18, { animate: true });
    marker.openPopup();
  }

  // ê²€ìƒ‰ / ì´ˆê¸°í™”
  if (searchInput) {
    searchInput.addEventListener("input", (e) => {
      updateTreeList(e.target.value);
    });
  }
  const btnClear = document.getElementById("btnTreeClear");
  if (btnClear) {
    btnClear.addEventListener("click", () => {
      searchInput.value = "";
      updateTreeList("");
    });
  }

  // ===== 7) ìˆ˜ëª© ì¶”ê°€ ëª¨ë“œ (ê°„ë‹¨ ë²„ì „) =====
  let addMode = false;

  function setAddMode(on) {
    addMode = on;
    if (addHint) {
      addHint.textContent = on
        ? "ì¶”ê°€ ëª¨ë“œ: ì§€ë„ì—ì„œ ìœ„ì¹˜ë¥¼ í´ë¦­í•˜ë©´ ìƒˆ ìˆ˜ëª©ì„ ë“±ë¡í•©ë‹ˆë‹¤."
        : "";
    }
  }

  const btnAdd = document.getElementById("btnTreeAdd");
  if (btnAdd) {
    btnAdd.addEventListener("click", () => {
      setAddMode(!addMode);
    });
  }

  map.on("click", (e) => {
    if (!addMode) return;

    const id = prompt("ìƒˆ ìˆ˜ëª© ID (ì˜ˆ: YA-010)", "");
    if (!id) {
      setAddMode(false);
      return;
    }
    const species = prompt("ìˆ˜ì¢…ëª… (ì˜ˆ: ì†Œë‚˜ë¬´)", "ì†Œë‚˜ë¬´") || "ë¯¸ì§€ì •";
    const zone = prompt("êµ¬ì—­ëª… (ì˜ˆ: ì •ë¬¸ Aì¡´)", "") || "-";
    const type = prompt("ìœ í˜• (êµëª©/ê´€ëª© ë“±)", "êµëª©") || "êµëª©";
    const status = prompt("ìƒíƒœ (ì–‘í˜¸/ì£¼ì˜/ë¶ˆëŸ‰)", "ì–‘í˜¸") || "ì–‘í˜¸";

    const newTree = {
      id,
      species,
      type,
      status,
      zone,
      lat: e.latlng.lat,
      lng: e.latlng.lng,
      height: null,
      dbh: null,
      crown: null,
      planted_year: null,
      slope: null,
      tilt: null,
      root_lift: false,
      drainage: "",
      trunk_crack: false,
      crown_lean: "",
      risk_score: null,
      health_score: null,
      risk_level: "LOW",
      history: {},
      disease: { has_issue:false, last_date:"-", detail:"-" },
      tag_id: "",
      nfc_id: "",
      qr_id: "",
      sensor_id: "",
      photo_url: "",
      created_by: "LMY",
      created_at: new Date().toISOString().slice(0,10),
      updated_at: new Date().toISOString().slice(0,10)
    };

    treeData.push(newTree);
    setAddMode(false);
    renderTreesOnMap();
  });

  // ===== 8) ì„œë²„ ì €ì¥ / ë¶ˆëŸ¬ì˜¤ê¸° (ì›í•˜ë©´ ì‚¬ìš©) =====
  async function loadTreesFromServer() {
    try {
      const res = await fetch("api/trees-load.php?ts=" + Date.now(), {
        cache: "no-store"
      });
      if (!res.ok) throw new Error("load fail");
      const data = await res.json();
      if (Array.isArray(data) && data.length) {
        treeData = data;
      }
    } catch (err) {
      console.warn("ì„œë²„ì—ì„œ ìˆ˜ëª© ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨, ê¸°ë³¸ê°’ ì‚¬ìš©", err);
    }
    renderTreesOnMap();
  }

  async function saveTreesToServer() {
    try {
      const res = await fetch("api/trees-save.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(treeData)
      });
      if (!res.ok) throw new Error("save fail");
      alert("ìˆ˜ëª© ë°ì´í„° ì €ì¥ ì™„ë£Œ");
    } catch (err) {
      console.error(err);
      alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
  }

  const btnSave = document.getElementById("btnTreeSave");
  if (btnSave) {
    btnSave.addEventListener("click", () => {
      saveTreesToServer();
    });
  }

  // -------- ë‚ ì”¨ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (DOMì— ê°’ ë„£ëŠ” ì—­í• ) --------
  function updateWeatherUI(weather) {
    const tempEl  = document.getElementById("todayTemp");
    const metaEl  = document.getElementById("todayMeta");
    const extraEl = document.getElementById("todayExtra");
    const listEl  = document.getElementById("forecastList");

    if (!tempEl || !metaEl || !extraEl || !listEl) return;

    tempEl.textContent = `${Math.round(weather.today.temp)}Â°C`;
    metaEl.textContent =
      `ì²´ê° ${Math.round(weather.today.feels_like)}Â°C Â· ìŠµë„ ${weather.today.humidity}%`;

    extraEl.innerHTML =
      `ê°•ìˆ˜í™•ë¥  ${Math.round(weather.today.pop * 100)}%<br>` +
      `í‰ê·  í’ì† ${weather.today.wind} m/s<br>` +
      `ìˆœê°„ ìµœëŒ€ ${weather.today.gust} m/s`;

    listEl.innerHTML = "";
    weather.forecast.forEach((d) => {
      const row = document.createElement("div");
      row.className = "weather-forecast-row";
      row.innerHTML = `
      <span>
          <div class="wf-label-main">${d.label}</div>
          <div class="wf-label-sub">${d.dateLabel || ""}</div>
        </span>
        <span>${d.desc}</span>
        <span>${Math.round(d.max)} / ${Math.round(d.min)}Â°C</span>
        <span>${d.wind} m/s</span>
      `;
      listEl.appendChild(row);
    });
  }

   // -------- OpenWeather ì‹¤ì‹œê°„ í˜¸ì¶œ (v2.5 weather + forecast ì‚¬ìš©) --------
  async function fetchWeather() {
    const lat = 37.4643;   // ì–‘ì¬ HQ ìœ„ë„
    const lon = 127.0428;  // ì–‘ì¬ HQ ê²½ë„
    const apiKey = "f8ac84ac53ac43039b1e5eca4cdc565c";  // í˜• í‚¤

    try {
      // 1) í˜„ì¬ ë‚ ì”¨
      const curRes = await fetch(
        `https://api.openweathermap.org/data/2.5/weather` +
        `?lat=${lat}&lon=${lon}&units=metric&lang=kr&appid=${apiKey}`
      );
      if (!curRes.ok) throw new Error("current weather fail: " + curRes.status);
      const cur = await curRes.json();

      // 2) 5ì¼ ì˜ˆë³´ (3ì‹œê°„ ê°„ê²©)
      const fcRes = await fetch(
        `https://api.openweathermap.org/data/2.5/forecast` +
        `?lat=${lat}&lon=${lon}&units=metric&lang=kr&appid=${apiKey}`
      );
      if (!fcRes.ok) throw new Error("forecast fail: " + fcRes.status);
      const fc = await fcRes.json();

      // ===== ì˜¤ëŠ˜ ë°ì´í„° ì •ë¦¬ =====
      const today = {
        temp: cur.main.temp,
        feels_like: cur.main.feels_like,
        humidity: cur.main.humidity,
        pop: 0,
        wind: cur.wind.speed,
        gust: cur.wind.gust ?? cur.wind.speed
      };

      // ì˜ˆë³´ ë¦¬ìŠ¤íŠ¸ì—ì„œ ë‚ ì§œë³„ë¡œ í•˜ë£¨ ëŒ€í‘œê°’ ë½‘ê¸° (ì •ì˜¤ 12ì‹œ ê·¼ì²˜ ê¸°ì¤€)
      const byDate = {};
      fc.list.forEach((item) => {
        const [dateStr, timeStr] = item.dt_txt.split(" ");
        // ë‚ ì§œë³„ í•˜ë‚˜ë§Œ ì €ì¥, ê°€ëŠ¥í•˜ë©´ 12:00:00ìœ¼ë¡œ ëŒ€ì²´
        if (!byDate[dateStr]) {
          byDate[dateStr] = item;
        }
        if (timeStr === "12:00:00") {
          byDate[dateStr] = item;
        }
      });

      const dates = Object.keys(byDate).sort();   // ë‚ ì§œ ìˆœ ì •ë ¬
      const dayNames = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];

      const forecast = dates.slice(0, 5).map((d, idx) => {
        const it = byDate[d];
        const dateObj = new Date(d + "T00:00:00");  // ë‚ ì§œ ê°ì²´ë¡œ ë³€í™˜

        // ë©”ì¸ ë¼ë²¨: 0=ì˜¤ëŠ˜, 1=ë‚´ì¼, ë‚˜ë¨¸ì§€ëŠ” ìš”ì¼
        let mainLabel;
        if (idx === 0) mainLabel = "ì˜¤ëŠ˜";
        else if (idx === 1) mainLabel = "ë‚´ì¼";
        else mainLabel = dayNames[dateObj.getDay()];

        // ì„œë¸Œ ë¼ë²¨: MM.DD. í˜•ì‹
        const mm = String(dateObj.getMonth() + 1).padStart(2, "0");
        const dd = String(dateObj.getDate()).padStart(2, "0");
        const subLabel = `${mm}.${dd}.`;

        return {
          label: mainLabel,        // ì˜¤ëŠ˜ / ë‚´ì¼ / ìš”ì¼
          dateLabel: subLabel,     // 12.02. ì´ëŸ° í˜•ì‹
          desc: it.weather?.[0]?.description ?? "ì˜ˆë³´ ì—†ìŒ",
          max: it.main.temp_max,
          min: it.main.temp_min,
          wind: it.wind?.speed ?? today.wind
        };
      });


      const weatherData = { today, forecast };
      updateWeatherUI(weatherData);
    } catch (err) {
      console.warn("ë‚ ì”¨ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨, ì½˜ì†” í™•ì¸:", err);

      // ì‹¤íŒ¨ ì‹œì—ë„ í™”ë©´ì´ ë¹„ì–´ìˆì§€ ì•Šë„ë¡ ê¸°ë³¸ê°’
      const fallback = {
        today: { temp: 27, feels_like: 29, humidity: 60, pop: 0.3, wind: 3, gust: 6 },
        forecast: [
          { label: "ì˜¤ëŠ˜",  desc: "ê°€ë” êµ¬ë¦„", max: 27, min: 19, wind: 3 },
          { label: "ë‚´ì¼",  desc: "ì†Œë‚˜ê¸°",   max: 26, min: 20, wind: 4 },
          { label: "2ì¼ í›„", desc: "ë§‘ìŒ",   max: 28, min: 18, wind: 2 },
          { label: "3ì¼ í›„", desc: "êµ¬ë¦„ ë§ìŒ", max: 27, min: 19, wind: 3 },
          { label: "4ì¼ í›„", desc: "ì•½í•œ ë¹„",   max: 25, min: 21, wind: 4 }
        ]
      };
      updateWeatherUI(fallback);
    }
  }


  // ì´ˆê¸° ì‹¤í–‰: ë‚ ì”¨ ë¨¼ì € ë¶ˆëŸ¬ì˜¤ê³ , ìˆ˜ëª© ë°ì´í„° ë¡œë“œ
  fetchWeather();
  loadTreesFromServer();
</script>


</body>
</html>
